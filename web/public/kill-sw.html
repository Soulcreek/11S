<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Unregister Service Worker</title>
</head>
<body>
  <h1>Unregistering service worker…</h1>
  <pre id="out"></pre>
  <script>
    (async () => {
      try {
        const out = s => { document.getElementById('out').textContent += s + "\n"; };
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          out(`Found ${regs.length} registrations`);
          for (const r of regs) {
            out(`Unregister ${r.scope}`);
            await r.unregister();
          }
        }
        if ('caches' in window) {
          const names = await caches.keys();
          out(`Found ${names.length} caches`);
          for (const n of names) {
            out(`Delete cache ${n}`);
            await caches.delete(n);
          }
        }
        out('Done. Reloading…');
        setTimeout(() => location.replace('/'), 1000);
      } catch (e) {
        document.getElementById('out').textContent = 'Error: ' + e.message;
      }
    })();
  </script>
</body>
</html>
